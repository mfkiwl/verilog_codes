This implementation takes cares of parallel inputs
